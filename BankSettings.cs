using MCM.Abstractions.Attributes;
using MCM.Abstractions.Attributes.v2;
using MCM.Abstractions.Settings.Base;
using MCM.Abstractions.Settings.Base.Global;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using TaleWorlds.Localization;

namespace IronBank
{
    public interface IBankSettingsProvider
    {
        float InterestRate { get; set; }

        float TaxIn { get; set; }

        float TaxOut { get; set; }

        float ReinvestmentRate { get; set; }
    }

    public class HardcodedBankSettings : IBankSettingsProvider
    {
        public float InterestRate { get; set; } = 0.002f;

        public float TaxIn { get; set; } = 0.025f;

        public float TaxOut { get; set; } = 0.035f;

        public float ReinvestmentRate { get; set; } = 0.2f;
    }

    public class BankSettings : AttributeGlobalSettings<BankSettings>, IBankSettingsProvider
    {
        public override string Id => "IronBank";

        public override string DisplayName => new TextObject(
            "{=Settings_Name}Iron Bank {VERSION}",
            new Dictionary<string, TextObject>
            {
                { "VERSION", new TextObject(typeof(BankSettings).Assembly.GetName().Version.ToString(3)) }
            }
        ).ToString();

        public override string FolderName { get; } = "IronBank";

        public override string FormatType { get; } = "json2";

        public override IDictionary<string, Func<BaseSettings>> GetAvailablePresets()
        {
            var realistic = new BankSettings()
            {
                InterestRate = 0.002f,
                TaxIn = 0.025f,
                TaxOut = 0.035f,
                ReinvestmentRate = 0.2f
            };
            var easy = new BankSettings()
            {
                InterestRate = 0.008f,
                TaxIn = 0.015f,
                TaxOut = 0.015f,
                ReinvestmentRate = 0.2f
            };
            var veryEasy = new BankSettings()
            {
                InterestRate = 0.01f,
                TaxIn = 0.05f,
                TaxOut = 0.05f,
                ReinvestmentRate = 0.2f
            };

            // Includes the 'Default' preset that MCM provides
            var basePresets = base.GetAvailablePresets();
            basePresets["Default"] = () => realistic;
            basePresets.Add("Realistic", () => realistic);
            basePresets.Add("Easy", () => easy);
            basePresets.Add("Very Easy", () => veryEasy);
            return basePresets;
        }

        [SettingPropertyGroup("{=IronBank_General}General")]
        [SettingPropertyFloatingInteger(
            "{=IronBank_Interests}Interest rate",
            minValue: 0.0f, maxValue: 0.05f, valueFormat: "P", RequireRestart = false,
            HintText = "Daily interest rate generated by your account."
        )]
        public float InterestRate { get; set; }

        [SettingPropertyGroup("{=IronBank_General}General")]
        [SettingPropertyFloatingInteger(
            "{=IronBank_Interests}Taxes on deposit",
            minValue: 0.0f, maxValue: 0.10f, valueFormat: "P", RequireRestart = false,
            HintText = "A tax applyed by the bank on every deposit."
        )]
        public float TaxIn { get; set; }

        [SettingPropertyGroup("{=IronBank_General}General")]
        [SettingPropertyFloatingInteger(
            "{=IronBank_Interests}Taxes on withdraw",
            minValue: 0.0f, maxValue: 0.10f, valueFormat: "P", RequireRestart = false,
            HintText = "A tax applyed by the bank on every widthdraw."
        )]
        public float TaxOut { get; set; }

        [SettingPropertyGroup("{=IronBank_General}General")]
        [SettingPropertyFloatingInteger(
            "{=IronBank_Interests}Reinvestment rate",
            minValue: 0f, maxValue: 1f, valueFormat: "P", RequireRestart = false,
            HintText = "Rate of interests to deposit in bank account."
        )]
        public float ReinvestmentRate { get; set; }
    }
}
